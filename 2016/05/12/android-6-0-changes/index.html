<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    <title>Android 6.0 变更 | 随手记 | 不积跬步无以至千里</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#03a9f4">
    
    
    <meta name="keywords" content="Anroid,Android Developers,Marshmallow,Anroid6.0">
    <meta name="description" content="Android 6.0（API 级别 23）除了提供诸多新特性和功能外，还对系统和 API 行为做出了各种变更。本文重点介绍您应该了解并在开发应用时加以考虑的一些主要变更。 如果您之前发布过 Android 应用，请注意您的应用可能受到这些平台变更的影响。 运行时权限 此版本引入了一种新的权限模式，如今，用户可直接在运行时管理应用权限。这种模式让用户能够更好地了解和控制权限，同时为应用开发者精简了">
<meta name="keywords" content="Anroid,Android Developers,Marshmallow,Anroid6.0">
<meta property="og:type" content="article">
<meta property="og:title" content="Android 6.0 变更">
<meta property="og:url" content="http://yoursite.com/2016/05/12/android-6-0-changes/index.html">
<meta property="og:site_name" content="随手记">
<meta property="og:description" content="Android 6.0（API 级别 23）除了提供诸多新特性和功能外，还对系统和 API 行为做出了各种变更。本文重点介绍您应该了解并在开发应用时加以考虑的一些主要变更。 如果您之前发布过 Android 应用，请注意您的应用可能受到这些平台变更的影响。 运行时权限 此版本引入了一种新的权限模式，如今，用户可直接在运行时管理应用权限。这种模式让用户能够更好地了解和控制权限，同时为应用开发者精简了">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yoursite.com/2016/05/12/android-6-0-changes/text-selection.gif">
<meta property="og:updated_time" content="2018-03-30T08:58:45.779Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android 6.0 变更">
<meta name="twitter:description" content="Android 6.0（API 级别 23）除了提供诸多新特性和功能外，还对系统和 API 行为做出了各种变更。本文重点介绍您应该了解并在开发应用时加以考虑的一些主要变更。 如果您之前发布过 Android 应用，请注意您的应用可能受到这些平台变更的影响。 运行时权限 此版本引入了一种新的权限模式，如今，用户可直接在运行时管理应用权限。这种模式让用户能够更好地了解和控制权限，同时为应用开发者精简了">
<meta name="twitter:image" content="http://yoursite.com/2016/05/12/android-6-0-changes/text-selection.gif">
    
        <link rel="alternate" type="application/atom+xml" title="随手记" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.7.2">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">马建</h5>
          <a href="mailto:markjoker@126.com" title="markjoker@126.com" class="mail">markjoker@126.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/markjoker" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="http://www.weibo.com/markjoker" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                微博
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/cv"  >
                <i class="icon icon-lg icon-file"></i>
                简历
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Android 6.0 变更</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Android 6.0 变更</h1>
        <h5 class="subtitle">
            
                <time datetime="2016-05-12T11:56:45.000Z" itemprop="datePublished" class="page-time">
  2016-05-12
</time>


            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>目录</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#运行时权限"><span class="post-toc-number">1.</span> <span class="post-toc-text">运行时权限</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#低电耗模式和应用待机模式"><span class="post-toc-number">2.</span> <span class="post-toc-text">低电耗模式和应用待机模式</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#取消支持-Apache-HTTP-客户端"><span class="post-toc-number">3.</span> <span class="post-toc-text">取消支持 Apache HTTP 客户端</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#BoringSSL"><span class="post-toc-number">4.</span> <span class="post-toc-text">BoringSSL</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#硬件标识符访问权"><span class="post-toc-number">5.</span> <span class="post-toc-text">硬件标识符访问权</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#通知"><span class="post-toc-number">6.</span> <span class="post-toc-text">通知</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#音频管理器变更"><span class="post-toc-number">7.</span> <span class="post-toc-text">音频管理器变更</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#文本选择"><span class="post-toc-number">8.</span> <span class="post-toc-text">文本选择</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#浏览器书签变更"><span class="post-toc-number">9.</span> <span class="post-toc-text">浏览器书签变更</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Android-密钥库变更"><span class="post-toc-number">10.</span> <span class="post-toc-text">Android 密钥库变更</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#WLAN-和网络连接变更"><span class="post-toc-number">11.</span> <span class="post-toc-text">WLAN 和网络连接变更</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#相机服务变更"><span class="post-toc-number">12.</span> <span class="post-toc-text">相机服务变更</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#运行时"><span class="post-toc-number">13.</span> <span class="post-toc-text">运行时</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#APK-验证"><span class="post-toc-number">14.</span> <span class="post-toc-text">APK 验证</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#USB-连接"><span class="post-toc-number">15.</span> <span class="post-toc-text">USB 连接</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Android-for-Work-变更"><span class="post-toc-number">16.</span> <span class="post-toc-text">Android for Work 变更</span></a></li></ol>
        </nav>
    </aside>


<article id="post-android-6-0-changes"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Android 6.0 变更</h1>
        <div class="post-meta">
            <time class="post-time" title="2016-05-12 19:56:45" datetime="2016-05-12T11:56:45.000Z"  itemprop="datePublished">2016-05-12</time>

            


            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>Android 6.0（API 级别 23）除了提供诸多新特性和功能外，还对系统和 API 行为做出了各种变更。本文重点介绍您应该了解并在开发应用时加以考虑的一些主要变更。</p>
<p>如果您之前发布过 Android 应用，请注意您的应用可能受到这些平台变更的影响。</p>
<h1 id="运行时权限"><a href="#运行时权限" class="headerlink" title="运行时权限"></a>运行时权限</h1><hr>
<p>此版本引入了一种新的权限模式，如今，用户可直接在运行时管理应用权限。这种模式让用户能够更好地了解和控制权限，同时为应用开发者精简了安装和自动更新过程。用户可为所安装的各个应用分别授予或撤销权限。</p>
<p>对于以 Android 6.0（API 级别 23）或更高版本为目标平台的应用，请务必在运行时检查和请求权限。要确定您的应用是否已被授予权限，请调用新增的 <code>checkSelfPermission()</code> 方法。要请求权限，请调用新增的 <code>requestPermissions()</code> 方法。即使您的应用并不以 Android 6.0（API 级别 23）为目标平台，您也应该在新权限模式下测试您的应用。</p>
<p>如需了解有关在您的应用中支持新权限模式的详情，请参阅<a href="https://developer.android.com/training/permissions/index.html" target="_blank" rel="noopener">使用系统权限</a>。如需了解有关如何评估新模式对应用的影响的提示，请参阅<a href="https://developer.android.com/training/permissions/best-practices.html#testing" target="_blank" rel="noopener">权限最佳做法</a>。</p>
<h1 id="低电耗模式和应用待机模式"><a href="#低电耗模式和应用待机模式" class="headerlink" title="低电耗模式和应用待机模式"></a>低电耗模式和应用待机模式</h1><hr>
<p>此版本引入了针对空闲设备和应用的最新节能优化技术。这些功能会影响所有应用，因此请务必在这些新模式下测试您的应用。</p>
<ul>
<li><strong>低电耗模式：</strong>如果用户拔下设备的电源插头，并在屏幕关闭后的一段时间内使其保持不活动状态，设备会进入低电耗模式，在该模式下设备会尝试让系统保持休眠状态。在该模式下，设备会定期短时间恢复正常工作，以便进行应用同步，还可让系统执行任何挂起的操作。</li>
<li><strong>应用待机模式：</strong>应用待机模式允许系统判定应用在用户未主动使用它时处于空闲状态。当用户有一段时间未触摸应用时，系统便会作出此判定。如果拔下了设备电源插头，系统会为其视为空闲的应用停用网络访问以及暂停同步和作业。<br>要详细了解这些节能变更，请参阅<a href="https://developer.android.com/training/monitoring-device-state/doze-standby.html" target="_blank" rel="noopener">对低电耗模式和应用待机模式进行针对性优化</a>。</li>
</ul>
<h1 id="取消支持-Apache-HTTP-客户端"><a href="#取消支持-Apache-HTTP-客户端" class="headerlink" title="取消支持 Apache HTTP 客户端"></a>取消支持 Apache HTTP 客户端</h1><hr>
<p>Android 6.0 版移除了对 Apache HTTP 客户端的支持。如果您的应用使用该客户端，并以 Android 2.3（API 级别 9）或更高版本为目标平台，请改用 <code>HttpURLConnection</code> 类。此 API 效率更高，因为它可以通过透明压缩和响应缓存减少网络使用，并可最大限度降低耗电量。要继续使用 Apache HTTP API，您必须先在 <code>build.gradle</code> 文件中声明以下编译时依赖项：<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    useLibrary <span class="string">'org.apache.http.legacy'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="BoringSSL"><a href="#BoringSSL" class="headerlink" title="BoringSSL"></a>BoringSSL</h1><hr>
<p>Android 正在从使用 OpenSSL 库转向使用 BoringSSL 库。如果您要在应用中使用 Android NDK，请勿链接到并非 NDK API 组成部分的加密库，如 libcrypto.so 和 libssl.so。这些库并非公共 API，可能会在不同版本和设备上毫无征兆地发生变化或出现故障。此外，您还可能让自己暴露在安全漏洞的风险之下。请改为修改原生代码，以通过 JNI 调用 Java 加密 API，或静态链接到您选择的加密库。</p>
<h1 id="硬件标识符访问权"><a href="#硬件标识符访问权" class="headerlink" title="硬件标识符访问权"></a>硬件标识符访问权</h1><hr>
<p>为给用户提供更严格的数据保护，从此版本开始，对于使用 WLAN API 和 Bluetooth API 的应用，Android 移除了对设备本地硬件标识符的编程访问权。<code>WifiInfo.getMacAddress()</code> 方法和 <code>BluetoothAdapter.getAddress()</code> 方法现在会返回常量值 02:00:00:00:00:00。</p>
<p>现在，要通过蓝牙和 WLAN 扫描访问附近外部设备的硬件标识符，您的应用必须拥有 <code>ACCESS_FINE_LOCATION</code> 或 <code>ACCESS_COARSE_LOCATION</code> 权限。</p>
<ul>
<li>WifiManager.getScanResults()</li>
<li>BluetoothDevice.ACTION_FOUND</li>
<li>BluetoothLeScanner.startScan()<blockquote>
<p><strong>注：</strong>当运行 Android 6.0（API 级别 23）的设备发起后台 WLAN 或蓝牙扫描时，在外部设备看来，该操作的发起来源是一个随机化 MAC 地址。</p>
</blockquote>
</li>
</ul>
<h1 id="通知"><a href="#通知" class="headerlink" title="通知"></a>通知</h1><hr>
<p>此版本移除了 <code>Notification.setLatestEventInfo()</code> 方法。请改用 <code>Notification.Builder</code> 类来构建通知。要重复更新通知，请重复使用 <code>Notification.Builder</code> 实例。调用 <code>build()</code> 方法可获取更新后的 <code>Notification</code> 实例。</p>
<p><code>adb shell dumpsys notification</code> 命令不再打印输出您的通知文本。请改用 <code>adb shell dumpsys notification --noredact</code> 命令打印输出 notification 对象中的文本。</p>
<h1 id="音频管理器变更"><a href="#音频管理器变更" class="headerlink" title="音频管理器变更"></a>音频管理器变更</h1><hr>
<p>不再支持通过 <code>AudioManager</code> 类直接设置音量或将特定音频流静音。<code>setStreamSolo()</code> 方法已弃用，您应该改为调用 <code>requestAudioFocus()</code> 方法。类似地，<code>setStreamMute()</code> 方法也已弃用，请改为调用 <code>adjustStreamVolume()</code> 方法并传入方向值 <code>ADJUST_MUTE</code> 或 <code>ADJUST_UNMUTE</code>。</p>
<h1 id="文本选择"><a href="#文本选择" class="headerlink" title="文本选择"></a>文本选择</h1><hr>
<p><img src="/2016/05/12/android-6-0-changes/text-selection.gif" style="width:300px; float: right; margin-left:20px"><br>现在，当用户在您的应用中选择文本时，您可以在一个浮动工具栏中显示“剪切”、“复制”和“粘贴”等文本选择操作。其在用户交互实现上与为单个视图启用上下文操作模式中所述的上下文操作栏类似。</p>
<p>要实现可用于文本选择的浮动工具栏，请在您的现有应用中做出以下更改：</p>
<ol>
<li>在 <code>View</code> 对象或 <code>Activity</code> 对象中，将 <code>ActionMode</code> 调用从 <code>startActionMode(Callback)</code> 更改为 <code>startActionMode(Callback, ActionMode.TYPE_FLOATING)</code>。</li>
<li>改为使用 <code>ActionMode.Callback</code> 的现有实现扩展 <code>ActionMode.Callback2</code>。</li>
<li>替代 <code>onGetContentRect()</code> 方法，用于提供 Rect 内容对象（如文本选择矩形）在视图中的坐标。</li>
<li>如果矩形的定位不再有效，并且这是唯一需要声明为无效的元素，请调用 <code>invalidateContentRect()</code> 方法。</li>
</ol>
<p>请注意，如果您使用 Android 支持库 22.2 修订版，浮动工具栏不向后兼容，默认情况下 appcompat 会获得对 <code>ActionMode</code> 对象的控制权。这会禁止显示浮动工具栏。要在 ActionMode 中启用 <code>AppCompatActivity</code> 支持，请调用 <code>getDelegate()</code>，然后对返回的 <code>setHandleNativeActionModesEnabled()</code> 对象调用 <code>AppCompatDelegate</code>，并将输入参数设置为 false。此调用会将 <code>ActionMode</code> 对象的控制权交还给框架。在运行 Android 6.0（API 级别 23）的设备上，框架可以支持 <code>ActionBar</code> 模式或浮动工具栏模式；而在运行 Android 5.1（API 级别 22）或之前版本的设备上，框架仅支持 <code>ActionBar</code> 模式。</p>
<h1 id="浏览器书签变更"><a href="#浏览器书签变更" class="headerlink" title="浏览器书签变更"></a>浏览器书签变更</h1><hr>
<p>此版本移除了对全局书签的支持。<code>android.provider.Browser.getAllBookmarks()</code> 和 <code>android.provider.Browser.saveBookmark()</code> 方法现已移除。同样，<code>READ_HISTORY_BOOKMARKS</code> 权限和 <code>WRITE_HISTORY_BOOKMARKS</code> 权限也已移除。如果您的应用以 Android 6.0（API 级别 23）或更高版本为目标平台，请勿从全局提供程序访问书签或使用书签权限。您的应用应改为在内部存储书签数据。</p>
<h1 id="Android-密钥库变更"><a href="#Android-密钥库变更" class="headerlink" title="Android 密钥库变更"></a>Android 密钥库变更</h1><hr>
<p>从此版本开始，Android 密钥库提供程序不再支持 DSA。但仍支持 ECDSA。</p>
<p>停用或重置安全锁定屏幕时（例如，由用户或设备管理员执行此类操作时），系统将不再删除需要闲时加密的密钥，但在上述事件期间会删除需要闲时加密的密钥。</p>
<h1 id="WLAN-和网络连接变更"><a href="#WLAN-和网络连接变更" class="headerlink" title="WLAN 和网络连接变更"></a>WLAN 和网络连接变更</h1><hr>
<p>此版本对 WLAN API 和 Networking API 引入了以下行为变更。</p>
<ul>
<li>现在，您的应用只能更改由您创建的 <code>WifiConfiguration</code> 对象的状态。系统不允许您修改或删除由用户或其他应用创建的 <code>WifiConfiguration</code> 对象。</li>
<li>在之前的版本中，如果应用利用带有 disableAllOthers=true 设置的 <code>enableNetwork()</code> 强制设备连接特定 WLAN 网络，设备将会断开与移动数据网络等其他网络的连接。在此版本中，设备不再断开与上述其他网络的连接。如果您的应用的 targetSdkVersion 为 “20” 或更低，则会固定连接所选 WLAN 网络。如果您的应用的 targetSdkVersion 为 “21” 或更高，请使用多网络 API（如 <code>openConnection()</code>、<code>bindSocket()</code> 和新增的 <code>bindProcessToNetwork()</code> 方法）来确保通过所选网络传送网络流量。</li>
</ul>
<h1 id="相机服务变更"><a href="#相机服务变更" class="headerlink" title="相机服务变更"></a>相机服务变更</h1><hr>
<p>在此版本中，相机服务中共享资源的访问模式已从之前的“先到先得”访问模式更改为高优先级进程优先的访问模式。对服务行为的变更包括：</p>
<ul>
<li>根据客户端应用进程的“优先级”授予对相机子系统资源的访问权，包括打开和配置相机设备。带有对用户可见 Activity 或前台 Activity 的应用进程一般会被授予较高的优先级，从而使相机资源的获取和使用更加可靠；</li>
<li>当高优先级的应用尝试使用相机时，系统可能会“驱逐”正在使用相机客户端的低优先级应用。在已弃用的 Camera API 中，这会导致系统为被驱逐的客户端调用 onError()。在 Camera2 API 中，这会导致系统为被驱逐的客户端调用 onDisconnected()；</li>
<li>在配备相应相机硬件的设备上，不同的应用进程可同时独立打开和使用不同的相机设备。但现在，如果在多进程用例中同时访问相机会造成任何打开的相机设备的性能或能力严重下降，相机服务会检测到这种情况并禁止同时访问。即使并没有其他应用直接尝试访问同一相机设备，此变更也可能导致低优先级客户端被“驱逐”。</li>
<li>更改当前用户会导致之前用户帐户拥有的应用内活动相机客户端被驱逐。对相机的访问仅限于访问当前设备用户拥有的用户个人资料。举例来说，这意味着，当用户切换到其他帐户后，“来宾”帐户实际上无法让使用相机子系统的进程保持运行状态。</li>
</ul>
<h1 id="运行时"><a href="#运行时" class="headerlink" title="运行时"></a>运行时</h1><hr>
<p>ART 运行时环境现在可正确实现 <code>newInstance()</code> 方法的访问规则。此变更修正了之前版本中 Dalvik 无法正确检查访问规则的问题。如果您的应用使用 newInstance() 方法，并且您想重写访问检查，请调用 <code>setAccessible()</code> 方法（将输入参数设置为 true）。如果您的应用使用 v7 appcompat 库或 v7 recyclerview 库，则您必须更新应用以使用这些库的最新版本。否则，请务必更新从 XML 引用的任何自定义类，以便能够访问它们的类构造函数。</p>
<p>此版本更新了动态链接程序的行为。动态链接程序现在可以识别库的 soname 与其路径之间的差异（公开错误 6670），并且现在已实现了按 soname 搜索。之前包含错误的 DT_NEEDED 条目（通常是开发计算机文件系统上的绝对路径）却仍工作正常的应用，如今可能会出现加载失败。</p>
<p>现已正确实现 dlopen(3) RTLD_LOCAL 标记。请注意，RTLD_LOCAL 是默认值，因此不显式使用 RTLD_LOCAL 的 dlopen(3) 调用将受到影响（除非您的应用显式使用 RTLD_GLOBAL）。使用 RTLD_LOCAL 时，在随后通过调用 dlopen(3) 加载的库中并不能使用这些符号（这与由 DT_NEEDED 条目引用的情况截然不同）。</p>
<p>在之前版本的 Android 上，如果您的应用请求系统加载包含文本重定位信息的共享库，系统会显示警告，但仍允许加载共享库。从此版本开始，如果您的应用的目标 SDK 版本为 23 或更高，则系统会拒绝加载该库。为帮助您检测库是否加载失败，您的应用应该记录 dlopen(3) 失败日志，并在日志中加入 dlerror(3) 调用返回的问题描述文本。要详细了解如何处理文本重定位，请参阅此指南。</p>
<h1 id="APK-验证"><a href="#APK-验证" class="headerlink" title="APK 验证"></a>APK 验证</h1><hr>
<p>该平台现在执行的 APK 验证更为严格。如果在清单中声明的文件在 APK 中并不存在，该 APK 将被视为已损坏。移除任何内容后必须重新签署 APK。</p>
<h1 id="USB-连接"><a href="#USB-连接" class="headerlink" title="USB 连接"></a>USB 连接</h1><hr>
<p>默认情况下，现在通过 USB 端口进行的设备连接设置为仅充电模式。要通过 USB 连接访问设备及其内容，用户必须明确地为此类交互授予权限。如果您的应用支持用户通过 USB 端口与设备进行交互，请将必须显式启用交互考虑在内。</p>
<h1 id="Android-for-Work-变更"><a href="#Android-for-Work-变更" class="headerlink" title="Android for Work 变更"></a>Android for Work 变更</h1><hr>
<p>此版本包含下列针对 Android for Work 的行为变更：</p>
<ul>
<li><strong>个人上下文中的工作联系人：</strong>Google 拨号器通话记录现在会在用户查看通话记录时显示工作联系人。将 setCrossProfileCallerIdDisabled() 设置为 true 可在 Google 拨号器通话记录中隐藏托管配置文件联系人。仅当您将 setBluetoothContactSharingDisabled() 设置为 false 时，才可以通过蓝牙将工作联系人随个人联系人一起显示给设备。默认情况下，它设置为 true。</li>
<li><strong>WLAN 配置删除：</strong>现在，当删除某个托管配置文件时，将会移除由配置文件所有者添加的 WLAN 配置（例如，通过调用 addNetwork() 方法添加的配置）。</li>
<li><strong>WLAN 配置锁定：</strong>如果 WIFI_DEVICE_OWNER_CONFIGS_LOCKDOWN 不为零，则用户无法再修改或删除任何由活动设备所有者创建的 WLAN 配置。用户仍可创建和修改其自己的 WLAN 配置。活动设备所有者拥有编辑或删除任何 WLAN 配置（包括并非由其创建的配置）的权限。</li>
<li><strong>通过添加 Google 帐户下载设备规范控制器：</strong>向托管环境以外的设备添加需要通过设备规范控制器 (DPC) 应用管理的 Google 帐户时，帐户添加流程现在会提示用户安装相应的 WPC。在设备初始设置向导中通过 Settings &gt; Accounts 添加帐户时，也会出现此行为。</li>
<li><strong>对特定 DevicePolicyManager API 行为的变更：</strong><ul>
<li>调用 setCameraDisabled() 方法只会影响调用该方法的用户的相机；从托管配置文件调用它不会影响主用户运行的相机应用。</li>
<li>此外，setKeyguardDisabledFeatures() 方法现在除了可供设备所有者使用外，还可供配置文件所有 者使用。</li>
<li>配置文件所有者可设置以下键盘锁限制：<pre><code>- KEYGUARD_DISABLE_TRUST_AGENTS 和 KEYGUARD_DISABLE_FINGERPRINT，它们影响配置文件上级用户的键盘锁设置。
- KEYGUARD_DISABLE_UNREDACTED_NOTIFICATIONS，它只影响应用在托管配置文件中生成的通知。
</code></pre></li>
<li>DevicePolicyManager.createAndInitializeUser() 方法和 DevicePolicyManager.createUser() 方法已弃用。</li>
<li>当给定用户的应用在前台运行时，setScreenCaptureDisabled() 方法现在也会屏蔽辅助结构。</li>
<li>EXTRA_PROVISIONING_DEVICE_ADMIN_PACKAGE_CHECKSUM 现在默认为 SHA-256。出于向后兼容性考虑，仍然支持 SHA-1，但未来将会取消该支持。  EXTRA_PROVISIONING_DEVICE_ADMIN_SIGNATURE_CHECKSUM 现在只接受 SHA-256。<ul>
<li>Android 6.0（API 级别 23）中曾经存在的 Device initializer API 现已删除</li>
<li>EXTRA_PROVISIONING_RESET_PROTECTION_PARAMETERS 已删除，因此 NFC 占位配置无法通过编程解锁受恢复出厂设置保护的设备</li>
<li>您现在可以使用 EXTRA_PROVISIONING_ADMIN_EXTRAS_BUNDLE extra 在对托管设备进行 NFC 配置期间向设备所有者应用传递数据。</li>
<li>Android for Work API 针对 M 运行时权限（包括 Work 配置文件、辅助层及其他内容）进行了优化。新增的 DevicePolicyManager 权限 API 不会影响 M 之前版本的应用。</li>
<li>当用户退出通过 ACTION_PROVISION_MANAGED_PROFILE 或 ACTION_PROVISION_MANAGED_DEVICE intent 发起的设置流程的同步部分时，系统现在会返回 RESULT_CANCELED 结果代码。</li>
</ul>
</li>
</ul>
</li>
<li>对其他 API 的变更：<ul>
<li>流量消耗：android.app.usage.NetworkUsageStats 类已重命名为 NetworkStats。</li>
</ul>
</li>
<li>对全局设置的变更：<ul>
<li>这些设置不再通过 setGlobalSettings() 进行设置：<ul>
<li>BLUETOOTH_ON</li>
<li>DEVELOPMENT_SETTINGS_ENABLED</li>
<li>MODE_RINGER</li>
<li>NETWORK_PREFERENCE</li>
<li>WIFI_ON</li>
</ul>
</li>
<li>这些全局设置现在可通过 setGlobalSettings() 进行设置：<br>  -WIFI_DEVICE_OWNER_CONFIGS_LOCKDOWN</li>
</ul>
</li>
</ul>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2018-03-30T08:58:45.779Z" itemprop="dateUpdated">2018-03-30 16:58:45</time>
</span><br>


        
        这里可以写作者留言，标签和 hexo 中所有变量及辅助函数等均可调用，示例：<a href="/2016/05/12/android-6-0-changes/" target="_blank" rel="external">http://yoursite.com/2016/05/12/android-6-0-changes/</a>
        
    </div>
    
    <footer>
        <a href="http://yoursite.com">
            <img src="/img/avatar.jpg" alt="马建">
            马建
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android-Developers/">Android Developers</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Anroid/">Anroid</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Anroid6-0/">Anroid6.0</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Marshmallow/">Marshmallow</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://yoursite.com/2016/05/12/android-6-0-changes/&title=《Android 6.0 变更》 — 随手记&pic=http://yoursite.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://yoursite.com/2016/05/12/android-6-0-changes/&title=《Android 6.0 变更》 — 随手记&source=desc" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://yoursite.com/2016/05/12/android-6-0-changes/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Android 6.0 变更》 — 随手记&url=http://yoursite.com/2016/05/12/android-6-0-changes/&via=http://yoursite.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://yoursite.com/2016/05/12/android-6-0-changes/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2016/12/30/android-7-0/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Android 7.0 API 概览</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2016/04/30/android-6-0/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Android 6.0 API 概述</h4>
      </a>
    </div>
  
</nav>



    














</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢大爷~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.jpg" data-alipay="/img/alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>马建 &copy; 2015 - 2018</span>
            <span>
                
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://yoursite.com/2016/05/12/android-6-0-changes/&title=《Android 6.0 变更》 — 随手记&pic=http://yoursite.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://yoursite.com/2016/05/12/android-6-0-changes/&title=《Android 6.0 变更》 — 随手记&source=desc" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://yoursite.com/2016/05/12/android-6-0-changes/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Android 6.0 变更》 — 随手记&url=http://yoursite.com/2016/05/12/android-6-0-changes/&via=http://yoursite.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://yoursite.com/2016/05/12/android-6-0-changes/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACJ0lEQVR42u3ay47jQAgF0Pz/T7u3I6WduYDTkvGpleU8yscLBBSvV7yOf9b7/bPr95X82/v9yxYGBsZtGcfHlTxWldoDf94dAwPjCYyzCHb2nWoATUJzsu/pfQwMDIwgvFbv9PbFwMDA6DGSx5okjhgYGBh5Efv5r6vlbp5EXlyLY2Bg3JCRd93//vor5xsYGBi3YhzF1QuyyW9HT4WBgbGakQe4nJenbpOAi4GB8UxG3tavDoRNksK8DMbAwNjK6A1AJIcKUYhsHRv88ikGBsZqRjWwVh9r3uBrHmFiYGCsY+Qf5wGxNy52AQADA2MpozficO1I6wUJKAYGxlLGpIidHwBUS9mv1OIYGBg3YSQBNw+g+cNVg/7p9zEwMB7DSIrV3mY5r9nmw8DAWM2Yj1xUy+DqXtHhJQYGxmpG3t6aJ4j5dfX1YWBgPIcxCX+9tLJ6LHq6FwYGxmpGdTgsCn9xQ38ybHH6HQwMjNWMZMyimjJOmv55Yw4DA+MJjHxgYr7x5BjgPxgMDIyHMfKG/qSVVh0ve+XTZxgYGKsZeXurmvCNMtbgJWJgYGxlHMU1elsXhfvTpBADA2Mpo5p39Vr8+dHCJMXEwMDYzUiC7DfGMqqtvdGZBgYGxgpGtX9VHfOajH9FrwYDAwNjnORN4iQGBgZGL+BW6+M8ocwPJKKZEQwMjEWMpIitjlZUjwqqCSIGBsZzGL3SMS9We6206iEEBgbGUsYP90V0cj9Inq4AAAAASUVORK5CYII=" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="/js/main.min.js?v=1.7.2"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.7.2" async></script>






<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '瞎！';
            clearTimeout(titleTime);
        } else {
            document.title = '(つェ⊂)!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
